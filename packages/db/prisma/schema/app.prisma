model Role {
  id   String @id @default(cuid())
  name String @unique

  users UserRole[]
}

model UserRole {
  userId String
  roleId String

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  role Role @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@id([userId, roleId])
}

model Ministry {
  id          String   @id @default(cuid())
  name        String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Ministry Admins (leaders who can manage the ministry)
  admins     MinistryAdmin[]
  members    MinistryMember[]
  requests   MinistryRequest[]
  currentMembers User[] @relation("UserCurrentMinistry")
}

model MinistryAdmin {
  id         String   @id @default(cuid())
  userId     String
  ministryId String
  role       String   @default("LEADER") // LEADER, ADMIN

  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  ministry Ministry @relation(fields: [ministryId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([userId, ministryId])
}

enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
}

model MinistryRequest {
  id          String       @id @default(cuid())
  userId      String
  ministryId  String
  status     RequestStatus @default(PENDING)
  requestedBy String       // User who requested
  reviewedBy  String?      // Admin who reviewed
  reviewedAt DateTime?
  notes       String?

  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  ministry Ministry @relation(fields: [ministryId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([userId, ministryId])
}

model MinistryMember {
  userId     String
  ministryId String
  role       String   @default("MEMBER") // MEMBER, LEADER

  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  ministry Ministry @relation(fields: [ministryId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@id([userId, ministryId])
}

model Zone {
  id          String  @id @default(cuid())
  name        String
  description String?

  pastorId String
  pastor   User   @relation("ZonePastor", fields: [pastorId], references: [id])

  families Family[]
  members  ZoneMember[]

  // Users assigned to this zone
  users User[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ZoneMember {
  zoneId String
  userId String

  zone Zone @relation(fields: [zoneId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([zoneId, userId])
}

model Family {
  id          String  @id @default(cuid())
  name        String
  description String?

  zoneId String
  zone   Zone   @relation(fields: [zoneId], references: [id], onDelete: Cascade)

  members User[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum FamilyMemberType {
  FATHER
  MOTHER
  SON
  DAUGHTER
}
